<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Bayesian Spatial Regression</title>
<meta name="description" content="katie jolly&#39;s portfolio site">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,300,700,400italic">
<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/owl.carousel.css">
<link rel="stylesheet" href="/css/owl.theme.css">


  <link href="/css/style.sea.css" rel="stylesheet" id="theme-stylesheet">

 

  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  


<link href="/css/custom.css" rel="stylesheet">
<link rel="shortcut icon" href="/img/favicon.png">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-109851039-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
  <div id="all">
      <div class="container-fluid">
          <div class="row row-offcanvas row-offcanvas-left">
              <div id="sidebar" class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas">
  <div class="sidebar-content">
    <h1 class="sidebar-heading"><a href="/">  katie jolly  </a></h1>
    
      <p class="sidebar-p">geographic data science, open <br> data, and information design //<br> saint paul, mn</p>
    
    <ul class="sidebar-menu">
      
        <li><a href="/portfolio/">Portfolio</a></li>
      
        <li><a href="http://katiejolly.io/blog/">Blog</a></li>
      
        <li><a href="/about/">About</a></li>
      
        <li><a href="/contact/">Get in touch</a></li>
      
    </ul>
    <p class="social">
  
  
  
  <a href="https://twitter.com/katiejolly6" data-animate-hover="pulse" class="external twitter">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  <a href="mailto:katiejolly6@gmail.com" data-animate-hover="pulse" class="email">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  <a href="https://www.linkedin.com/in/katie-jolly-6001987b/" data-animate-hover="pulse" class="external">
    <i class="fa fa-linkedin"></i>
  </a>
  
  
  
  <a href="https://github.com/katiejolly" data-animate-hover="pulse" class="external">
    <i class="fa fa-github"></i>
  </a>
  
  
</p>


    <div class="copyright">
      <p class="credit">
        
          &copy;2018 katie jolly
        
        | Template by <a href="https://bootstrapious.com/free-templates" class="external">Bootstrapious.com</a>

&amp; ported to Hugo by <a href="https://github.com/kishaningithub">Kishan B</a>

      </p>
    </div>
  </div>
</div>

              
<div class="col-xs-12 col-sm-8 col-md-9 content-column white-background">
  <div class="small-navbar visible-xs">
  <button type="button" data-toggle="offcanvas" class="btn btn-ghost pull-left"> <i class="fa fa-align-left"> </i>Menu</button>
  <h1 class="small-navbar-heading"><a href="/">  katie jolly  </a></h1>
</div>

  <div class="row">
    <div class="col-lg-8">
      <div class="content-column-content">
         <h1>Bayesian Spatial Regression</h1>
         


<p>This project is about vaccine exemption rates in California kindergartens.</p>
<p><br>
<br></p>
<p>With the rise of the anti-vax movement, we are interested in what demographic factors might be connected or at higher risk. Previous research has shows that white, wealtier communities as well as certain immigrant communities are the most at-risk. We also acknowledge the spatial aspect of this data, making a spatial model more suitable.</p>
<p>My school level immunization data comes from the California Department of Health and is aggregated over the 2012-3013, 2013-2014, and 2014-2015 school years to smooth out some of the more unstable rates. My demographic data is Census data collected at the tract level. I use this data because it is the most reliable and standard. In order to connect these two datasets, I will do a spatial join to figure out which schools are in which census tracts.</p>
<p><br>
<br></p>
<div id="data-and-packages" class="section level2">
<h2>Data and packages</h2>
<pre class="r"><code>library(rjags)
library(tidyverse)
library(sf)
library(extrafont)

load(&quot;~/portfolio/static/data/04_spatial_joins_zcta.RData&quot;)

demographic_and_pbe_data_clean &lt;- demographic_and_pbe_data_zcta %&gt;%
  select(-c(57:61, 63)) %&gt;%
  select(-58) %&gt;%
  st_transform(26911) %&gt;%
  mutate_at(vars(c(2, 4:28)), funs(as.numeric)) %&gt;%
  mutate(percent_white = ifelse(is.nan(percent_white), NA, percent_white),
         weighted_mean_pbe_rate_zcta = ifelse(is.nan(weighted_mean_pbe_rate_zcta), NA, weighted_mean_pbe_rate_zcta),
         log_weighted_mean_pbe_rate_zcta = log(weighted_mean_pbe_rate_zcta + 0.001))

theme_katie &lt;- theme(text = element_text(family = &quot;Franklin Gothic Book&quot;, color = &quot;#041A26&quot;))</code></pre>
<p><strong>School level data on vaccination rates</strong></p>
<table>
<colgroup>
<col width="16%" />
<col width="83%" />
</colgroup>
<thead>
<tr class="header">
<th>Variable name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>street</td>
<td>Street address of school</td>
</tr>
<tr class="even">
<td>city</td>
<td>City of school</td>
</tr>
<tr class="odd">
<td>zip</td>
<td>9-digit zip code of school</td>
</tr>
<tr class="even">
<td>county_1</td>
<td>County of school</td>
</tr>
<tr class="odd">
<td>public_priv</td>
<td>Type of school (public or private)</td>
</tr>
<tr class="even">
<td>school_name</td>
<td>Name of school</td>
</tr>
<tr class="odd">
<td>lat_dec</td>
<td>Latitude</td>
</tr>
<tr class="even">
<td>lon_dec</td>
<td>Longitude</td>
</tr>
<tr class="odd">
<td>enroll_tot</td>
<td>Total enrollment over 2012-2013, 2013-2014, and 2014-2015</td>
</tr>
<tr class="even">
<td>pbe_tot</td>
<td>Total personal belief exemptions over 2012-2013, 2013-2014, and 2014-2015</td>
</tr>
<tr class="odd">
<td>pbe_rate</td>
<td>Total PBEs divided by total enrollment</td>
</tr>
</tbody>
</table>
<p><br>
<br></p>
<p><strong>Census zcta level demographic data</strong></p>
<table>
<colgroup>
<col width="22%" />
<col width="77%" />
</colgroup>
<thead>
<tr class="header">
<th>Variable name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>geoid</td>
<td>Unique identifier</td>
</tr>
<tr class="even">
<td>estimate_total_pop</td>
<td>Estimated total population in 2015</td>
</tr>
<tr class="odd">
<td>name</td>
<td>Name of census zcta</td>
</tr>
<tr class="even">
<td>moe_total_pop</td>
<td>Margin of error on total population estimate in 2015</td>
</tr>
<tr class="odd">
<td>estimate_total_bachelor_degree</td>
<td>Estimate of the total adult population with a bachelor’s degree as the highest form of education in 2015</td>
</tr>
<tr class="even">
<td>estimate_hs_diploma</td>
<td>Estimate of the total adult population with a high school diploma as the highest form of education in 2015</td>
</tr>
<tr class="odd">
<td>estimate_total_foreign_born</td>
<td>Estimate of the total population that was not born in the U.S.</td>
</tr>
<tr class="even">
<td>estimate_hh_med_income</td>
<td>Estimate of the household median income in 2015</td>
</tr>
<tr class="odd">
<td>estimate_total_pop_hisp</td>
<td>Estimate of the total Hispanic population in 2015</td>
</tr>
<tr class="even">
<td>estimate_median_age_total</td>
<td>Estimate of the median age in 2015</td>
</tr>
<tr class="odd">
<td>estimate_total_white_alone</td>
<td>Estimate of the population that identifies only as white in 2015</td>
</tr>
</tbody>
</table>
<p><br>
<br></p>
</div>
<div id="visualizations" class="section level2">
<h2>Visualizations</h2>
<p><br>
<br></p>
<pre class="r"><code>ggplot() + 
  geom_sf(data = demographic_and_pbe_data_zcta, aes(fill = weighted_mean_pbe_rate_zcta), color = &quot;gray80&quot;) +
  scale_fill_gradient(low = &quot;darkorchid1&quot;, high = &quot;darkorchid4&quot;, name = &quot;Weighted mean PBE rate&quot;, na.value = &quot;gray80&quot;) + theme_minimal() + theme(text = element_text(family = &quot;Franklin Gothic Book&quot;), panel.grid.major = element_line(&quot;transparent&quot;)) + labs(title = &quot;PBE rates across California zip codes&quot;)</code></pre>
<p><img src="/portfolio/bayesian-spatial-modeling_files/figure-html/unnamed-chunk-2-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br>
<br></p>
<pre class="r"><code>ggplot(demographic_and_pbe_data_clean, aes(x = schools)) +
  geom_histogram(aes(y = ..density..), binwidth = 1, fill = &quot;#F1E8B8&quot;, color = &quot;white&quot;) +
  geom_density(color = &quot;#D05353&quot; ) +
  theme_minimal() +
  theme(text = element_text(family = &quot;Franklin Gothic Book&quot;)) +
  labs(title = &quot;Most zip codes have only a few schools, and the most common number is one&quot;, x= &quot;Number of schools&quot;, y = &quot;Density&quot;) +
  scale_x_continuous(breaks = c(1, 5, 10, 15))</code></pre>
<p><img src="/portfolio/bayesian-spatial-modeling_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br>
<br></p>
<pre class="r"><code>ggplot(demographic_and_pbe_data_clean, aes(x = percent_white, y = weighted_mean_pbe_rate_zcta)) +
  geom_point(color = &quot;#E58F65&quot;) +
  geom_smooth(color = &quot;#D05353&quot;) +
  theme_minimal() + 
  theme(text = element_text(family = &quot;Franklin Gothic Book&quot;)) +
  labs(title = &quot;In general higher white populations are more likely to have \nmore personal belief exemptions&quot;)</code></pre>
<p><img src="/portfolio/bayesian-spatial-modeling_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br>
<br></p>
</div>
<div id="modeling" class="section level2">
<h2>Modeling</h2>
<p><br>
<br></p>
<p>I start by modeling the relationship between the percent of a zip code’s population that is white according to the Census and the weighted mean personal belief exemption in a zip code.</p>
<p><span class="math display">\[\text{weighted mean pbe rate} = \beta_0 + \beta_1 * \text{percent white}\]</span></p>
<pre class="r"><code>library(rjags)

clean_data &lt;- demographic_and_pbe_data_clean %&gt;%
  st_set_geometry(NULL) %&gt;%
  select(weighted_mean_pbe_rate_zcta, percent_white) %&gt;%
  tidyr::drop_na()


# Define the model
pbe_model &lt;- &quot;model{
    #Data
    for(i in 1:length(y)) {
        y[i] ~ dnorm(mu[i], tau)
        mu[i] &lt;- beta0 + beta1*x[i]         
    }

    #Priors
    beta0 ~ dnorm(m0, t0)
    beta1 ~ dnorm(m1, t1)
    tau   ~ dgamma(s, r)
}&quot;
    
    
# Compile the model
pbe_jags &lt;- jags.model(textConnection(pbe_model), 
    data = list(y = clean_data$weighted_mean_pbe_rate_zcta, x = clean_data$percent_white, m0 = 0, t0 = 1/(10^2), m1 = 0.1, t1 = 1/(10^2), s = 10, r = 30000000),
    inits=list(.RNG.name=&quot;base::Wichmann-Hill&quot;, .RNG.seed=454))</code></pre>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 1316
##    Unobserved stochastic nodes: 3
##    Total graph size: 5269
## 
## Initializing model</code></pre>
<pre class="r"><code># Simulate the model
pbe_sim &lt;- coda.samples(pbe_jags,
    variable.names=c(&quot;beta0&quot;,&quot;beta1&quot;,&quot;tau&quot;), 
    n.iter=10000)


# Quick plot
plot(pbe_sim)</code></pre>
<p><img src="/portfolio/bayesian-spatial-modeling_files/figure-html/unnamed-chunk-5-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p><br>
<br></p>
<pre class="r"><code>pbe_chains &lt;- data.frame(iteration = 1:10000, pbe_sim[[1]])

cred_interval &lt;- pbe_chains %&gt;%
  summarise(min = quantile(beta1, 0.025), max = quantile(beta1, 0.975))

ggplot(pbe_chains, aes(x = beta1)) +
  geom_histogram(fill = &quot;#E58F65&quot;, color = &quot;white&quot;) +
  theme_minimal() +
  geom_vline(xintercept = cred_interval$min[1]) +
  geom_vline(xintercept = cred_interval$max[1]) +
  theme_katie +
  labs()</code></pre>
<p><img src="/portfolio/bayesian-spatial-modeling_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>

         <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "@katie_jolly" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
         
      </div>
    </div>
  </div>
</div>

          </div>
      </div>
  </div>
  <script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.cookie.js"> </script>
<script src="/js/ekko-lightbox.js"></script>
<script src="/js/jquery.scrollTo.min.js"></script>
<script src="/js/masonry.pkgd.min.js"></script>
<script src="/js/imagesloaded.pkgd.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/front.js"></script>

</body>
</html>
